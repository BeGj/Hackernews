"use strict";(self.webpackChunkhackernews=self.webpackChunkhackernews||[]).push([[746],{9746:(H,v,r)=>{r.r(v),r.d(v,{ListPostsComponent:()=>z});var p=r(5093),g=r(7717),T=r(4599),c=r(1676),f=r(8730),l=r(7292),x=r(9927),h=r(808),m=r(5653),P=r(2177),C=r(103),t=r(4023);let Z=(()=>{class s{transform(e){try{return new URL(e).hostname}catch{return""}}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275pipe=t.Yjl({name:"urlPreview",type:s,pure:!0,standalone:!0}),s})(),L=(()=>{class s{constructor(){this.localStorageKey="saved-posts",this.savedPostsCache$=new l.X([]),this.loadSavedPostsFromLocalStorage(),this.updateCacheWhenLocalstorageChanges()}savePost(e){const o=this.savedPostsCache$.value;o.push(e),this.savePostsToLocalStorageAndCache(o)}unSavePost(e){this.savePostsToLocalStorageAndCache(this.savedPostsCache$.value.filter(n=>n!==e))}getSavedPosts$(e,o){return this.savedPostsCache$.pipe((0,c.U)(n=>void 0!==e&&void 0!==o?n.slice(e,o):void 0!==e&&void 0===o?n.slice(e,o=e+50>499?499:e+50):void 0===e&&void 0!==o?n.slice(e=o-50<0?0:o-50,o):n))}loadSavedPostsFromLocalStorage(){let e=[];const o=localStorage.getItem(this.localStorageKey);return o&&(e=JSON.parse(o)),this.savedPostsCache$.next(e),e}updateCacheWhenLocalstorageChanges(){addEventListener("storage",e=>{if(e.key===this.localStorageKey){let o=[];o=e.newValue?JSON.parse(e.newValue):[],this.savedPostsCache$.next(o)}})}savePostsToLocalStorageAndCache(e){this.savedPostsCache$.next(e),localStorage.setItem(this.localStorageKey,JSON.stringify(e))}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var w=r(3779);function $(s,i){if(1&s&&(t.TgZ(0,"p",9),t._uU(1),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.hij(" ",e.index,". ")}}function _(s,i){if(1&s&&(t.TgZ(0,"a",10),t._uU(1),t.TgZ(2,"span",11),t._uU(3),t.ALo(4,"urlPreview"),t.qZA()()),2&s){const e=t.oxw();t.Q6J("href",e.post.url,t.LSH),t.xp6(1),t.hij(" ",e.post.title," "),t.xp6(2),t.hij("(",t.lcZ(4,3,e.post.url),")")}}const y=function(s){return["/posts",s]};function S(s,i){if(1&s&&(t.TgZ(0,"a",12),t._UZ(1,"span",13),t.qZA()),2&s){const e=t.oxw();t.Q6J("routerLink",t.VKq(2,y,e.post.id)),t.xp6(1),t.Q6J("innerHTML",e.sanitizer.bypassSecurityTrustHtml(e.post.title),t.oJD)}}function A(s,i){if(1&s&&(t.TgZ(0,"a",7),t._uU(1),t.qZA()),2&s){const e=t.oxw(2);t.Q6J("routerLink",t.VKq(2,y,e.post.id)),t.xp6(1),t.hij(" ",e.post.descendants," comments. ")}}function U(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"span",16),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.savedPostsService.unSavePost(n.post.id))}),t._uU(1," Unsave post. "),t.qZA()}}function I(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"span",16),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.savedPostsService.savePost(n.post.id))}),t._uU(1," Save post. "),t.qZA()}}function J(s,i){if(1&s&&(t.TgZ(0,"p",6),t.YNc(1,A,2,4,"a",14),t.YNc(2,U,2,0,"span",15),t.YNc(3,I,2,0,"span",15),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",void 0!==e.post.descendants),t.xp6(1),t.Q6J("ngIf",!0===e.post.saved),t.xp6(1),t.Q6J("ngIf",!1===e.post.saved)}}const N=function(s){return["/user",s]};let Y=(()=>{class s{constructor(e,o){this.savedPostsService=e,this.sanitizer=o}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(L),t.Y36(w.H7))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-list-view-post"]],inputs:{post:"post",index:"index"},standalone:!0,features:[t.jDz],decls:12,vars:13,consts:[[1,"flex","flex-row","px-2","space-x-2"],[1,"flex","flex-row","justify-center","w-4","place-content-center"],["class","my-auto font-mono text-xl font-bold text-gray-600",4,"ngIf"],[1,"flex-1"],["class","text-lg font-semibold transition-colors hover:text-orange-600 visited:text-gray-400 visited:hover:text-gray-600",3,"href",4,"ngIf"],["class","text-lg font-semibold transition-colors hover:text-orange-600 visited:text-gray-400 visited:hover:text-gray-600",3,"routerLink",4,"ngIf"],[1,"text-sm","text-gray-600"],[1,"hover:underline","underline-offset-2","decoration-orange-600",3,"routerLink"],["class","text-sm text-gray-600",4,"ngIf"],[1,"my-auto","font-mono","text-xl","font-bold","text-gray-600"],[1,"text-lg","font-semibold","transition-colors","hover:text-orange-600","visited:text-gray-400","visited:hover:text-gray-600",3,"href"],[1,"text-xs","text-gray-400"],[1,"text-lg","font-semibold","transition-colors","hover:text-orange-600","visited:text-gray-400","visited:hover:text-gray-600",3,"routerLink"],[3,"innerHTML"],["class","hover:underline underline-offset-2 decoration-orange-600",3,"routerLink",4,"ngIf"],["class","cursor-pointer hover:underline underline-offset-2 decoration-orange-600",3,"click",4,"ngIf"],[1,"cursor-pointer","hover:underline","underline-offset-2","decoration-orange-600",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,$,2,1,"p",2),t.qZA(),t.TgZ(3,"div",3),t.YNc(4,_,5,5,"a",4),t.YNc(5,S,2,4,"a",5),t.TgZ(6,"p",6),t._uU(7),t.ALo(8,"date"),t.TgZ(9,"a",7),t._uU(10),t.qZA()(),t.YNc(11,J,4,3,"p",8),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",void 0!==o.index),t.xp6(2),t.Q6J("ngIf",void 0!==o.post.url),t.xp6(1),t.Q6J("ngIf",void 0===o.post.url),t.xp6(2),t.AsE(" ",o.post.score," point posted at ",t.xi3(8,8,1e3*o.post.time,"medium")," by "),t.xp6(2),t.Q6J("routerLink",t.VKq(11,N,o.post.by)),t.xp6(1),t.Oqu(o.post.by),t.xp6(1),t.Q6J("ngIf","story"===o.post.type))},dependencies:[p.ez,p.O5,p.uU,Z,g.Bz,g.rH],changeDetection:0}),s})();var d=r(2285),Q=r(8571);function V(s,i){if(1&s&&(t.TgZ(0,"span",6),t._uU(1),t.qZA()),2&s){const e=i.ngrxLet;t.xp6(1),t.Oqu(e)}}function j(s,i){1&s&&(t.TgZ(0,"span",6),t._uU(1,"Loading posts..."),t.qZA())}function b(s,i){1&s&&(t.TgZ(0,"span",6),t._uU(1," Loading posts info... "),t.qZA())}function F(s,i){if(1&s&&(t._UZ(0,"app-list-view-post",9),t.ALo(1,"ngrxPush")),2&s){const e=i.$implicit,o=i.index,n=t.oxw(2);let a;t.Q6J("post",e)("index",o+1+(null!==(a=t.lcZ(1,2,n.firstPostIndex$))&&void 0!==a?a:0))}}function K(s,i){if(1&s&&(t.TgZ(0,"section",7),t.YNc(1,F,2,4,"app-list-view-post",8),t.qZA()),2&s){const e=i.ngrxLet;t.xp6(1),t.Q6J("ngForOf",e)}}function k(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"section",10),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.lastPostIndex$.next(n.lastPostIndex$.value+12))}),t.TgZ(1,"div",11),t._uU(2," Load more posts! "),t.qZA()()}}let z=(()=>{class s{set postsPageType(e){this.triggerPostsLoad$.next(e)}constructor(e,o){this.savedPostsService=e,this.firebase=o,this.triggerPostsLoad$=new T.t,this.pageTitle$=this.triggerPostsLoad$.pipe((0,c.U)(n=>"saved-posts"===n?"Your saved posts":"Top posts"),(0,f.d)()),this.firstPostIndex$=new l.X(0),this.lastPostIndex$=new l.X(12),this.postsLoading$=new l.X(!0),this.postsContentLoading$=new l.X(!1),this.postIds$=(0,x.a)([this.firstPostIndex$,this.lastPostIndex$,this.triggerPostsLoad$]).pipe((0,h.b)(n=>{this.postsLoading$.next(!0),this.postsContentLoading$.next(!0)}),(0,m.w)(([n,a,u])=>{switch(u){case"saved-posts":return this.savedPostsService.getSavedPosts$(n,a);case"top-posts":return this.firebase.fetchTopPosts(n,a);default:return console.log("Error. No PostsPageType"),(0,P.of)([])}}),(0,h.b)(n=>{this.postsLoading$.next(!1)}),(0,f.d)()),this.posts$=(0,x.a)([this.postIds$.pipe((0,m.w)(n=>n.length>0?(0,x.a)(n.map(a=>this.firebase.fetchPost(a))):(0,P.of)([])),(0,c.U)(n=>n.filter(a=>"story"===a.type))),this.savedPostsService.getSavedPosts$()]).pipe((0,c.U)(([n,a])=>n.map(u=>({...u,saved:a.includes(u.id)}))),(0,h.b)(()=>{this.postsContentLoading$.next(!1)}),(0,f.d)()),this.postsCount$=(0,C.T)(this.postIds$.pipe((0,c.U)(n=>n.length)),this.posts$.pipe((0,c.U)(n=>n.length)))}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(L),t.Y36(Q.$))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-list-posts"]],inputs:{postsPageType:"postsPageType"},standalone:!0,features:[t.jDz],decls:14,vars:16,consts:[[1,"mb-2"],[1,"text-xl"],["class","text-gray-600",4,"ngrxLet"],["class","text-gray-600",4,"ngIf"],["class","flex flex-col space-y-2",4,"ngrxLet"],["class","flex flex-row justify-center h-12 my-2 text-lg transition-colors bg-gray-200 rounded-md cursor-pointer hover:text-orange-600 hover:bg-gray-300 place-items-center",3,"click",4,"ngIf"],[1,"text-gray-600"],[1,"flex","flex-col","space-y-2"],[3,"post","index",4,"ngFor","ngForOf"],[3,"post","index"],[1,"flex","flex-row","justify-center","h-12","my-2","text-lg","transition-colors","bg-gray-200","rounded-md","cursor-pointer","hover:text-orange-600","hover:bg-gray-300","place-items-center",3,"click"],[1,"font-semibold","transition-colors","select-none"]],template:function(e,o){1&e&&(t.TgZ(0,"section",0)(1,"p",1),t._uU(2),t.ALo(3,"ngrxPush"),t.YNc(4,V,2,1,"span",2),t.YNc(5,j,2,0,"span",3),t.ALo(6,"ngrxPush"),t._uU(7,") "),t.YNc(8,b,2,0,"span",3),t.ALo(9,"ngrxPush"),t.ALo(10,"ngrxPush"),t.qZA()(),t.YNc(11,K,2,1,"section",4),t.YNc(12,k,3,0,"section",5),t.ALo(13,"ngrxPush")),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,6,o.pageTitle$)," ("),t.xp6(2),t.Q6J("ngrxLet",o.postsCount$),t.xp6(1),t.Q6J("ngIf",!0===t.lcZ(6,8,o.postsLoading$)),t.xp6(3),t.Q6J("ngIf",!1===t.lcZ(9,10,o.postsLoading$)&&!0===t.lcZ(10,12,o.postsContentLoading$)),t.xp6(3),t.Q6J("ngrxLet",o.posts$),t.xp6(1),t.Q6J("ngIf",!t.lcZ(13,14,o.postsContentLoading$)))},dependencies:[p.ez,p.sg,p.O5,g.Bz,Y,d._N,d.eJ,d.pP,d.fM],changeDetection:0}),s})()}}]);